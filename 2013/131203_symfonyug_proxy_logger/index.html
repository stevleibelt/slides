<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Proxy Logger Component</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/talk.css" media="all"></link></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1500"><div class="step" step="0" data-x="0" data-y="0"><h1 id="proxy-logger-component">Proxy Logger Component</h1><div class="line-block">03.12.2013<br></br><a href="http://www.meetup.com/sfughh/events/143293602">Symfony User Group Hamburg</a><br></br><a href="http://www.mindworks.de">mindworks GmbH</a><br></br></div></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="what-is-this-talk-about">What Is This Talk About?</h1><ul><li>distinction between logging, metrics and writing of history</li><li>present a concept of logging</li><li>present a logging component</li></ul></div><div class="step" step="2" data-x="3200" data-y="0"><h1 id="why-at-a-symfony-usergroup">Why At A Symfony UserGroup?</h1><pre class="highlight code php"><span class="x">"symfony/event-dispatcher": "v2.3.5"    //since version 1.2.0 :-)</span></pre></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="distinction-between-logging-metrics-or-writing-of-history">Distinction Between Logging, Metrics Or Writing Of History</h1><p>We are web developers and <a href="http://en.wikipedia.org/wiki/Web_analytics">web analytics</a> is a mixture of all.</p><blockquote><p><a href="http://en.wikipedia.org/wiki/Web_analytics">Web analytics is the measurement, collection, analysis and reporting of internet data for purposes of understanding and optimizing web usage.</a></p></blockquote></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="what-is-it-all-about">What Is It All About?</h1><ul><li>analyse internal data</li><li>archive internal data</li><li>collect internal data</li><li>meter internal data</li><li>record internal data</li></ul></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="logging">Logging?</h1><div class="line-block">In computing, a logfile or simply log is a file that <em>records events</em> taking place <em>in</em> the <em>execution of a system</em> in order <em>to provide an audit trail</em> that can be used to understand the activity of the system and to diagnose problems. The act of keeping a logfile is called logging. (<a href="http://en.wikipedia.org/wiki/Logfile">[0]</a>)<br></br></div></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="metrics">Metrics?</h1><div class="line-block">A software metric <em>is a measure of some property</em> of a piece of software or its specifications [...]<br></br>The goal is obtaining objective, reproducible and quantifiable measurements, which may have numerous valuable applications in schedule and budget planning, cost estimation, quality assurance testing, software debugging, software performance optimization, and optimal personnel task assignments. (<a href="http://en.wikipedia.org/wiki/Software_metric">[1]</a>)<br></br></div></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="writing-of-history">Writing Of History?</h1><ul><li><dl><dt><em>recoding</em> of <em>events</em> like:</dt><dd><ul><li>user (id 3) had registerd with link "<a href="http://www.foo.bar/my-add-uuid-123">http://www.foo.bar/my-add-uuid-123</a>"</li><li>user (id 3) purchased contract (id 9)</li><li>archive user interactions for the reason of law</li></ul></dd></dl></li><li><dl><dt><em>preserve state</em> of a bunch of data</dt><dd><ul><li>create graph of data transformation</li><li>record when happen what on which set of data</li></ul></dd></dl></li></ul></div><div class="step" step="8" data-x="12800" data-y="0"><h1 id="and-graylog2-is">And Graylog2 Is?</h1><div class="line-block">As an example.<br></br>Graylog2 is for data analysis (<a href="http://www.graylog2.org/">[2]</a>)<br></br></div><p>So graylog is pure <a href="http://en.wikipedia.org/wiki/Web_analytics">web analytics</a> (doing all at once if you ask me).</p></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="summary">Summary</h1><ul><li>don't do web analytics</li><li>do logging</li><li>do metrics</li><li>do writing of history</li></ul></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="and-also">And Also ...</h1><ul><li>figure out what your customer want</li><li><dl><dt>your customer should know what to measure</dt><dd><ul><li>avoid measure everything</li><li>do not interpret data by adding <em>wished</em> cross connections</li></ul></dd></dl></li><li>try to define common terms for your team and your customer</li><li>separate you data (by metric, logging and history)</li><li>create logger, history and metric handler (even if they are all simple file writer)</li></ul></div><div class="step" step="11" data-x="17600" data-y="0"><h1 id="a-concept-of-logging">A Concept Of Logging</h1></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="what-do-i-mean-with-logging">What Do I Mean With Logging?</h1><ul><li>not webserver logs but web application logs</li><li>record of workflow / processed data</li><li>dump of processed data if something went wrong</li><li>logging per instance (webserver)</li><li>deletion of log files or entries should be fearless</li><li>changing of log behaviour without fear</li><li>split logs into logical units (import/export/registration)</li></ul></div><div class="step" step="13" data-x="20800" data-y="0"><h1 id="what-i-struggled-with">What I Struggled With</h1><ul><li>never found the right balance between logging enough to debug and do not glut the logfiles</li><li>set loglevel to warning and you are loosing notice, info or debug</li><li>set loglevel to info and your log file will be flooded with messages</li></ul></div><div class="step" step="14" data-x="22400" data-y="0"><h1 id="what-i-need">What I Need</h1><ul><li>if something goes wrong, "i want it all" (<a href="http://en.wikipedia.org/wiki/I_Want_It_All">[3]</a>)</li></ul></div><div class="step" step="15" data-x="24000" data-y="0"><h1 id="how-to-solve-this-problem">How To Solve This Problem?</h1><p><em>Log all</em> process <em>data</em> but <em>only when something goes wrong</em>.</p></div><div class="step" step="16" data-x="25600" data-y="0"><h1 id="meaning">Meaning?</h1><ul><li>buffer log entries</li><li>clean or flush the buffer under well defined circumstances</li><li>deal with (a collection of) psr3 loggers</li><li>one log target (file/database column/whatever) per logical log unit (like import/purchase/migration)</li></ul></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="a-logging-component">A Logging Component</h1></div><div class="step" step="18" data-x="28800" data-y="0"><h1 id="history-of-development">History Of Development</h1><ul><li>so i searched and found nothing good for php</li><li>started developing and released <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/0.9.0">version 0.9.0</a> with <em>FlushBufferTrigger</em></li><li>it was working but, it looks like a <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/documentation/VersionHistory.md">first draft</a> ;-)</li><li><a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/1.0.0">version 1.0.0</a> adds a lot of examples and the <em>BypassBuffer</em></li><li>big refactoring leads to <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/1.1.0">version 1.1.0</a></li><li>implementation of event driven design leads to <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/1.2.0">version 1.2.0</a></li><li>story continues :-)</li><li>later on i stumbled over <a href="https://github.com/Seldaek/monolog">monolog</a> and its <a href="https://github.com/Seldaek/monolog/tree/master/src/Monolog/Handler/FingersCrossed">FingersCrossedHandler</a> (so i'm not alone with that concept of logging :-))</li><li>monolog looks like a big, monolithic logging component (sorry if i'm wrong)</li></ul></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="what-it-is-1-2">What It Is (1/2)</h1><ul><li>it simple deals with log entries</li><li>defines a <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/source/Net/Bazzline/Component/ProxyLogger/LogRequest/LogRequestInterface.php">log request</a> as a php object</li><li>wraps your existing logger or loggers</li><li>handles a logger collection with the <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/source/Net/Bazzline/Component/ProxyLogger/Logger/ProxyLoggerInterface.php">proxy logger</a></li><li>buffer a bunch of log entries with the <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/source/Net/Bazzline/Component/ProxyLogger/Logger/BufferLoggerInterface.php">buffer logger</a></li><li>controls the buffer behaviour with the <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/master/source/Net/Bazzline/Component/ProxyLogger/BufferManipulator">buffer manipulators</a></li></ul></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="what-it-is-2-2">What It Is (2/2)</h1><ul><li>influences the process flow by the <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/master/source/Net/Bazzline/Component/ProxyLogger/Event">event driven</a> design</li><li>supports laziness with the <a href="https://github.com/stevleibelt/php_component_proxy_logger/tree/master/source/Net/Bazzline/Component/ProxyLogger/Factory">factories</a></li><li>validates the given log levels <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/source/Net/Bazzline/Component/ProxyLogger/Validator/IsValidLogLevel.php">IsValidLogLevel</a></li><li>follows <a href="http://en.wikipedia.org/wiki/Unix_philosophy">unix philosophy</a> (do one thing and do it well)</li><li>enriches you existing logger component</li></ul></div><div class="step" step="21" data-x="33600" data-y="0"><h1 id="what-it-is-not">What It Is Not</h1><ul><li>it does not care how to store</li><li>it does not care where to store</li><li>is not <em>the</em> logger component, just a part of it</li></ul></div><div class="step" step="22" data-x="35200" data-y="0"><h1 id="common-terms-1-2">Common Terms (1/2)</h1><ul><li>RealLogger represents a psr-3 logger</li><li>LogRequest represents a log request (log level, message and context)</li><li>LogRequestBuffer represents a collection of log requests that are not pushed to the real loggers</li></ul></div><div class="step" step="23" data-x="36800" data-y="0"><h1 id="common-terms-2-2">Common Terms (2/2)</h1><ul><li>ProxyLogger represents a collection of real loggers</li><li>BufferLogger represents as a log request keeper that pass each log request to a buffer</li><li>BypassBufferInterface represents a buffer manipulation to bypass a certain log level to all added real loggers</li><li>FlushBufferTriggerInterface represents a buffer manipulation to trigger a buffer flush based on a log level</li></ul></div><div class="step" step="24" data-x="38400" data-y="0"><h1 id="showtime">Showtime</h1><p>Time for some <a href="https://github.com/stevleibelt/php_component_proxy_logger/blob/master/examples/Example/ManipulateBufferLogger/ExampleWithUpwardFlushBufferTriggerVersusNormalLogger.php">example implementation</a>!</p></div><div class="step" step="25" data-x="40000" data-y="0"><h1 id="installation">Installation</h1><p>Use <a href="http://getcomposer.org">composer</a> and <a href="http://packagist.org">packagist</a>.</p><pre class="highlight code php"><span class="x">require: "net_bazzline/component_proxy_logger": "dev-master"</span></pre></div><div class="step" step="26" data-x="41600" data-y="0"><h1 id="how-to-use-it">How To Use It?</h1><h2 id="instead-of">instead of</h2><pre class="highlight code php"><span class="x">class MyLoggerFactory
{
    public function createMyProcessLogger()
    {
        return new Logger();
    }
}</span></pre></div><div class="step" step="27" data-x="43200" data-y="0"><h1 id="use">use</h1><pre class="highlight code php"><span class="x">class MyLoggerFactory
{
    public function createMyProcessLogger()
    {
        $realLogger = new Logger();

        //of course this should not be done on each create call
        $proxyLoggerFactory = new ProxyLoggerFactory();
        $proxyLogger = $proxyLoggerFactory-&gt;create($realLogger);

        return $proxyLogger;
    }
}</span></pre></div><div class="step" step="28" data-x="44800" data-y="0"><h1 id="what-else">What Else?</h1><p>If you have to deal with <a href="https://logging.apache.org/log4php/">log4php</a> loggers, use an <a href="https://github.com/stevleibelt/php_component_psr_and_log4php_adapter">adapter</a>.</p><p>And the adapter works vica versa (super cool, use a psr3 logger in a log4php environment).</p></div><div class="step" step="29" data-x="46400" data-y="0"><h1 id="recap">Recap</h1><ul><li>do not log all</li><li>structure your log</li><li>explain your customer that they want metric or history</li><li>add bugs or remarks to the <a href="https://github.com/stevleibelt/php_component_proxy_logger">component</a></li><li>joind the development <a href="https://github.com/bazzline">team</a></li></ul></div><div class="step" step="30" data-x="48000" data-y="0"><h1 id="questions">Questions?</h1><ul><li><dl><dt>who is using monolog?</dt><dd><ul><li>what are your experience?</li><li>positives</li><li>negatives?</li></ul></dd></dl></li><li>what loggers are you using?</li><li>do you use your log files to create metrics?</li></ul></div><div class="step" step="31" data-x="49600" data-y="0"><h1 id="your-opinion">Your Opinion?</h1><ul><li>how do you like the main idea of the component?</li></ul></div><div class="step" step="32" data-x="51200" data-y="0"><h1 id="thanks">Thanks!</h1></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>